# Model Metadata JSON

This document describes the JSON format used to store model metadata for all MHub models.
A `meta.json` is required for each MHub model.

The document structure is mainly aligned to the model card approach proposed by Mitchell, M. et al. (2019).

All fields not marked as optional are required.

```js
{
    "id": "...",            // this will be auto-generated by us.
    "name": "my_model",     // str: a unique mhub model id ([\w\_]+)
    "title": "My Model",    // str: a human readable title, used to display the model on the website
    "summary": {},          // obj: a summary of the model
    "details": {},          // obj: according to Model Card's first "Model Details" section
    "info": {}              // obj: collection of additional Model Card sections 
}
```

## ID

The id is a unique UUID v4 identifyer given to each MHub model.
The model ID will be auto-generated by us.

## Name

The name of a model is an alphanumeric string that uniquely identifies an MHub model. The ID must not contain spaces or other special characters except underscores. IDs are case insensitive and should be all lowercase. The ID must be meaningful. We recommend that model names be preceded by the manufacturer's abbreviation to avoid name collisions. If models have a common component, such as a single model trained for multiple use cases, they can be added as separate components. Components should be separated by an underscore. Avoid using underscores as part of the vendor name, model, or use case. A version should not be added for the first release on MHub, but only for subsequent releases that drastically change the functionality of the model. Components must be ordered from most to least generalizable.

Example: `vendor_model_usecase_version`.

## Title

The title th emodel will be displayed under on MHub's website and other integrations (e.g., out MHub 3D Slicer plugin). Choose a meaningful and concise name.

## Summary

```js
"/summary": {
    "description": "",
    "inputs": [],
    "outputs": [],
    "model": {},
    "data": {}
}
```

### Description

A brief description of the model summarizing the purpose and functions of the model as detailed in the Model Card sections below.
The description will be displayed in our model repository and therefore must be as precise and accurate as possible. We allow for a maximum length of 200 characters.

### Inputs

Describe all inputs of the model.
For each input, you will need to give a label which will be used as human readable short fort representation, a long term description and the format and modality of the input data. For format you can choose any of our supported [file types](https://github.com/MHubAI/mhubio/blob/main/mhubio/core/FileType.py). For modality, you can use any value supported by the [DICOM standard](https://www.dicomlibrary.com/dicom/modality/), you can find a list of commonly used modalities on MHub in our [meta template](https://github.com/MHubAI/mhubio/blob/main/mhubio/core/templates.py).

```js
"/summary/inputs": [
    {
        "label": "Input Image",
        "description": "The CT scan of a patient.",
        "format": "NIfTI",
        "modality": "CT", 
        "bodypartexamined": "Chest",
        "slicethickness": "2.5mm",
        "contrast": true,
        "noncontrast": false            
    }
]
```

### Outputs

Describe all outputs of the model.
For each output, you will need to give a label which will be used as human readable short fort representation, a long term description of the file and the type of the model which must be either `Segmentation`, `prediction` or `Classification`.

For segmentation models, provide a list of all segmentations (use [SegDB identifyers](https://github.com/MHubAI/SegDB/blob/main/segdb/data/segmentations.csv)) under the `classes` attribute.

```js
"/summary/outputs": [
    {
        "label": "Segmentation",
        "description": "Segmentation of the lung lobes",
        "type": "Segmentation",
        "classes": [
            "LEFT_UPPER_LUNG_LOBE",
            "LEFT_LOWER_LUNG_LOBE",
            "RIGHT_UPPER_LUNG_LOBE",
            "RIGHT_MIDDLE_LUNG_LOBE",
            "RIGHT_LOWER_LUNG_LOBE"
        ]
    }
]
```

### Model

```js
"/summary/model": {
    "architecture": "", // str: the model architecture (e.g. ResNet50)
    "training": "",     // str: the training method (e.g. supervised)
    "cmpapproach": "",  // str: the computational approach (2D or 3D)
}
```

***TODO**: we need to define some guideline / default values. E.g. for training: supervised, semi-supervised, unsupervised, transfer learning, ... And revisit the keys, aproach is very broad and might invite for explainations, however we need tag-style keywords here.*

### Data

Describe the data used to train and evaluate the model.

```js
"/summary/data": {
    "training": {
        "vol_samples": 0    // int:  number of samples (e.g. patients) used during training
    },      
    "evaluation": {
        "vol_samples": 0,   // int:  number of samples used for evaluation
    },
    "public": true,         // bool: wheather the model was evaluated on public data
    "external": false       // bool: wheather the model was cross-validated 
}
```

## Details

This section describes various details of the AI pipeline, the author, the maintaining team, references to the publication and the code repository.

```js
"/details": {
    "name": "",             // str:       the original name of the model (e.g., as used in publications)
    "version": "1.0.0",     // str:       the version of the model (x.y.z)
    "devteam": "",          // str:       the lab or development team of the model
    "authors": [],          // list[str]: the authors of the model
    "type": "",             // str:       short description of the model type (e.g., Relational two-stage U-Net (Cascade of two relational U-Net, trained end-to-end)
    "date": {
        "code": "dd.mm.yyyy",      // str: the date the code was published
        "weights": "dd.mm.yyyy",   // str: the date the weights were published
        "pub": "dd.mm.yyyy"        // str: the date the publication was published
    },
    "cite": "",             // str:       the citation of the publication (APA)
    "licence": {
        "code": "",         // str: the licence of the code
        "weights": "",      // str: the licence of the weights
    },
    "publications": [{      // list[obj]: list of publications (one required)
        "title": "",        // str: the full title of the publication
        "uri": "",          // str: the url of the publication
    }],
    "github": "",           // str: the url of the github repository
}
```

## Info

```js
"info": {
    "use": {},
    "evaluation": {},
    "training": {},
    "analyses": {},
    "ethics": {},
    "limitations": {}
}
```

Additional sections of the Model Card are bundled under info in the model json.
These sections contain detailed information and descriptions about the model's use case, how to use the model, the model's data compatibility, and additional information about the training process and evaluation results.

```js
"/info/*": {
    "text": "",         // str: the text of the section
    "references": [{    // list[str]: optional list of references (e.g., links)
        "label": "",    // str: the label of the reference
        "uri": ""       // str: the url of the reference
    }],
    "tables": [{        // list[obj]: optional list of tables
        "label": "",    // str: the label of the table
        "entries": {}   // obj[str->str]: table rows, the key will appear in the first, the value in the second column
    }]
}
```

Each section can be described with free text that is a minimum of 50 words and a maximum of 500 words. Text formatting (e.g., bold, italics, underlines, lists) is not allowed.

Links must not be included in the text, but may be added as references instead. Please reference the links in your text using the `[1]` notation, where the number in the brackets corresponds to the position indicated in the `references` array.

To display evaluation results or data statistics, you can add up to two tables per section.
For each table you can define a `label` that will be displayed above the table. You can add up to 10 entries per table. Each entry must have a `key` and a `value`. The `key` is displayed in the first column, the `value` in the second column. If you have less than 2 entries, you should do without a table and describe your results in the text of the respective section.

The following sections are mandatory:

- [x] Indended Use
- [x] Evaluation Data
- [x] Training Data
- [x] Quantitative analysis

The following sections are optional:  

- [ ] Ethical considerations
- [ ] Caveats and Recommendations
